# Textlint Web Checker - Claude AI アシスタント向けガイド

このドキュメントは、Claude AIアシスタントがこのプロジェクトで効果的に作業するための包括的なガイドです。

## プロジェクト概要

**Textlint Web Checker** は、ブラウザ上で動作する日本語文書の品質チェックツールです。textlintのルールセットを活用し、技術文書やAI生成文書に見られる問題を検出します。

### 主要な特徴
- **完全クライアントサイド実装**: サーバーサイド処理不要、ブラウザのみで動作
- **28種類のルール**: 技術文書ルール（23種類）+ AI文書ルール（5種類）
- **リアルタイムチェック**: 300msデバウンスでリアルタイムエラー検出
- **直感的なUI**: shadcn/uiコンポーネントとTailwind CSSによるモダンなデザイン
- **ダークモード対応**: ライト/ダークテーマの切り替え機能

### 現在の実装状況
- UIとして完全に機能する状態
- textlint統合は**モックデータ実装**（本家textlintは未統合）
- GitHub Pagesへのデプロイ設定は未実装

---

## Claude Code Configuration

### 必須ルール

#### 🔔 通知（重要）
- **全てのTODO完了時**または**ユーザーのアクションが必要な際**は、最後に**一度だけ**以下のコマンドを実行して通知する：
  ```bash
  afplay /System/Library/Sounds/Sosumi.aiff
  ```

#### 🇯🇵 言語設定
- **回答は日本語で行ってください**

#### ✅ TODO管理
TODOには**必ず**以下の項目を含めること：
1. ブランチ作成（feat-\<機能名\>、fix-\<修正内容\>等）
2. 実装内容のテスト（Playwright MCPを使用）
3. コミット
4. push（`git push -u origin <ブランチ名>`）
5. PR作成（まだ作成されていない場合）

---

## アプリケーションポート設定

### 開発環境（Vite開発サーバー）
- **フロントエンド**: `http://localhost:3000` (ポート: 3000)
- **注意**: ポート3000が使用中の場合、Viteは自動的に次の利用可能なポート（3001等）を使用します

### 本番環境
- **静的ファイル配信**: Express.jsサーバー（ポート: 3000または環境変数PORT）
- **注意**: このプロジェクトはバックエンドAPIを持たず、完全にクライアントサイドで動作します

### ⚠️ ポート番号変更の禁止
- **絶対に**ポート番号を勝手に変更しないこと
- ポートが使用中の場合は、以下の手順で対処：
  ```bash
  # ポート使用状況を確認
  lsof -i :3000

  # 必要に応じてプロセスをkill（慎重に）
  kill -9 <PID>
  ```

---

## 開発ワークフロー

### 作業開始時の必須操作

**必ず以下の操作を実行してください**（毎回全てTODOに含める）：

1. **専用ブランチの作成**
   ```bash
   # 機能追加の場合
   git checkout -b feat-<機能名>

   # バグ修正の場合
   git checkout -b fix-<修正内容>
   ```

2. **mainブランチでの直接作業は絶対禁止**
   - いかなる変更もmainブランチに直接コミットしない
   - 必ずフィーチャーブランチを作成すること

### 作業終了時の必須操作

**必ず以下を順番に実行してください**：

1. **作業内容をコミット**
   ```bash
   git add .
   git commit -m "$(cat <<'EOF'
   適切なコミットメッセージ
   EOF
   )"
   ```

2. **リモートブランチにpush**
   ```bash
   git push -u origin <ブランチ名>
   ```

3. **PR作成**
   - MCPツールを使用してPRを作成
   - PRのタイトルと説明を明確に記述

---

## 修正・実装時の注意点

### 修正を行う際の原則

1. **影響範囲の慎重な確認**
   - 該当修正によって他の処理に問題がないか慎重に確認すること
   - 既存の機能が正常に動作するように修正すること

2. **既存機能の保護**
   - 他の動作に関しても修正が必要な場合は、既存の期待値の動作が正常に起動するように修正すること

### コミット前の必須確認事項

**コミット前には必ず以下を実施してください**：

1. **動作確認の実施**
   - Playwright MCPを使用して動作確認を行う
   - E2Eテストとしてユーザー目線での動作が問題ないか確認

2. **エラーの解決**
   - 動作確認中にエラーが発見された際はタスクを更新
   - コミットする際はエラーがない状態で行う

3. **テストユーザー情報**（開発・テスト時に使用）
   ```
   メールアドレス: jobanyol2020@gmail.com
   パスワード: Claude_code_test
   ユーザー名: TestAnyol
   ユーザーID: testjobanyol
   ```

   **注意**: このプロジェクトは現在ユーザー認証機能を持っていません。将来的に追加される場合に使用してください。

---

## コードベースの構造

### ディレクトリ構成

```
textlint-web-checker/
├── client/                    # フロントエンドコード
│   ├── public/               # 静的ファイル
│   ├── src/
│   │   ├── components/       # Reactコンポーネント
│   │   │   ├── ui/          # shadcn/uiコンポーネント（再利用可能）
│   │   │   ├── ErrorBoundary.tsx
│   │   │   ├── ManusDialog.tsx
│   │   │   └── Map.tsx
│   │   ├── contexts/        # Reactコンテキスト
│   │   │   └── ThemeContext.tsx  # ダークモード管理
│   │   ├── hooks/           # カスタムフック
│   │   │   ├── useTextlint.ts    # textlint統合（モック実装）
│   │   │   ├── useComposition.ts
│   │   │   ├── useMobile.tsx
│   │   │   └── usePersistFn.ts
│   │   ├── pages/           # ページコンポーネント
│   │   │   ├── Home.tsx     # メインページ
│   │   │   └── NotFound.tsx
│   │   ├── lib/             # ユーティリティ
│   │   │   └── utils.ts
│   │   ├── types/           # TypeScript型定義
│   │   │   └── textlint.d.ts
│   │   ├── App.tsx          # ルート定義（wouter）
│   │   ├── main.tsx         # エントリーポイント
│   │   ├── index.css        # グローバルスタイル
│   │   └── const.ts         # 定数定義
│   └── index.html           # HTMLテンプレート
├── server/                   # サーバーコード
│   └── index.ts             # Express.js（静的ファイル配信のみ）
├── shared/                   # フロントエンド・サーバー間で共有されるコード
│   └── const.ts             # 共有定数
├── patches/                  # pnpmパッチファイル
├── .textlintrc.json         # textlint設定
├── package.json             # 依存関係
├── vite.config.ts           # Vite設定
├── tailwind.config.ts       # Tailwind CSS設定
├── tsconfig.json            # TypeScript設定
├── components.json          # shadcn/ui設定
├── todo.md                  # タスク管理
└── README.md                # プロジェクト説明
```

### 主要ファイルの説明

#### `client/src/hooks/useTextlint.ts`
- textlint統合のためのカスタムフック
- **現在はモックデータ実装**（本家textlintは未統合）
- `generateMockLintResult`関数：正規表現とパターンマッチングで28種類のルールをシミュレート
- `lintText`関数：非同期でテキストを解析し、エラー/警告のリストを返す

#### `client/src/pages/Home.tsx`
- メインページのコンポーネント
- テキスト入力エリア、チェック結果パネル、エラーリスト、ルール設定ダイアログ
- 300msデバウンス処理によるリアルタイムlintチェック

#### `client/src/contexts/ThemeContext.tsx`
- ダークモードの状態管理
- `useTheme`フックでテーマの取得と切り替え

#### `client/src/App.tsx`
- wRouterによるクライアントサイドルーティング
- ThemeProviderとTooltipProviderのセットアップ

#### `server/index.ts`
- Express.jsサーバー（本番環境で静的ファイル配信のみ）
- すべてのルートで`index.html`を返す（クライアントサイドルーティング対応）

#### `.textlintrc.json`
- textlintの設定ファイル
- **注意**: 現在は参照用であり、実際のtextlint統合では使用されていません

---

## 技術スタック

### フロントエンド
| 技術 | バージョン | 用途 |
|------|-----------|------|
| React | 18.3.1 | UIライブラリ |
| TypeScript | 5.6.3 | 型安全な開発 |
| Vite | 7.1.7 | ビルドツール |
| Tailwind CSS | 4.1.14 | スタイリング |
| shadcn/ui | latest | UIコンポーネント（Radix UI + Tailwind） |
| Wouter | 3.3.5 | クライアントサイドルーティング |
| Framer Motion | 12.23.22 | アニメーション |

### textlint関連（計画中）
| パッケージ | バージョン | 用途 | 統合状況 |
|-----------|-----------|------|---------|
| @textlint/kernel | 15.3.0 | textlintコアエンジン | 未統合 |
| textlint-rule-preset-ja-technical-writing | 12.0.2 | 技術文書ルール（23ルール） | モック実装 |
| @textlint-ja/textlint-rule-preset-ai-writing | 1.6.1 | AI文書ルール（5ルール） | モック実装 |
| @textlint/textlint-plugin-markdown | 15.3.0 | Markdownサポート | 未統合 |
| @textlint/textlint-plugin-text | 15.3.0 | プレーンテキストサポート | 未統合 |
| kuromojin | 3.0.1 | 形態素解析 | 未統合 |

### サーバーサイド
| 技術 | バージョン | 用途 |
|------|-----------|------|
| Express | 4.21.2 | 静的ファイル配信 |
| Node.js | 22.x以上 | ランタイム |

### 開発ツール
| ツール | 用途 |
|--------|------|
| pnpm | パッケージマネージャー |
| Prettier | コードフォーマット |
| ESBuild | サーバーサイドのビルド |

---

## 開発ガイドライン

### コーディング規約

#### スタイリング
- **Tailwind CSSを優先**して使用すること
- 重複スタイルは避けること
- カスタムCSSは`index.css`に記述すること
- shadcn/uiコンポーネントをカスタマイズする際は、`components/ui/`内で直接編集すること

#### TypeScript
- **型安全性を最優先**すること
- `any`型の使用は避け、適切な型を定義すること
- 型定義ファイルは`client/src/types/`に配置すること

#### コンポーネント設計
- **関心の分離**を意識すること
  - UIコンポーネント: `components/ui/`
  - ビジネスロジックを含むコンポーネント: `components/`
  - ページコンポーネント: `pages/`
- **再利用可能なコンポーネント**を作成すること
- **カスタムフック**でロジックを分離すること（`hooks/`）

#### 状態管理
- React標準の`useState`と`useContext`を使用すること
- Reduxなどの外部ライブラリは使用しない（現在の方針）
- グローバルな状態は`contexts/`にコンテキストを作成すること

### ファイル作成時の注意点

**ファイル作成時には必ず以下を確認してください**：

1. **gitignore設定**
   - ファイルがGitHubに挙げられるべきではないと判断した場合、**必ず`.gitignore`に追加**すること
   - 例: 環境変数ファイル（`.env`）、ログファイル、一時ファイル等

2. **ファイル配置ルール**
   - UIコンポーネント → `client/src/components/ui/`
   - カスタムフック → `client/src/hooks/`
   - 型定義 → `client/src/types/`
   - ページ → `client/src/pages/`
   - ユーティリティ → `client/src/lib/`

### コード品質

#### セキュリティ
- **絶対に**以下の脆弱性を導入しないこと：
  - コマンドインジェクション
  - XSS（Cross-Site Scripting）
  - SQLインジェクション（現在はDBを使用していないが、将来的に注意）
  - OWASP Top 10の脆弱性

- 不安全なコードを書いた場合は、**即座に修正**すること

#### パフォーマンス
- 大量のテキスト（10,000文字以上）を処理する場合のパフォーマンスに注意
- 不要な再レンダリングを避けるため、`React.memo`と`useMemo`を活用すること
- デバウンス処理を適切に使用すること（現在は300ms）

---

## テスト・動作確認

### 必須確認事項（コミット前に必ず実施）

1. **Playwright MCPツールの使用**
   - テスト・動作確認の際は**Playwright MCPツール**を使用すること
   - E2Eテストとしてユーザー目線での動作が問題ないか確認すること

2. **確認すべき項目**
   - テキスト入力エリアが正常に動作するか
   - lintチェックがリアルタイムで実行されるか
   - エラーリストが正しく表示されるか
   - エラークリックで該当箇所にスクロールするか
   - ルール設定の有効化/無効化が機能するか
   - ダークモード切り替えが機能するか
   - データの永続化（localStorage）が機能するか
   - コピー/クリア/JSON出力が機能するか

3. **修正を行った際は必ずテストを実行**
   - 既存機能が壊れていないか確認すること

### 手動テスト手順

1. **基本機能のテスト**
   ```
   1. アプリケーションを起動（http://localhost:3000）
   2. テキストエリアにサンプルテキストを入力
   3. エラー/警告が表示されることを確認
   4. エラーをクリックして該当箇所にスクロールすることを確認
   5. フィルター（すべて/エラーのみ/警告のみ）が機能することを確認
   ```

2. **ルール設定のテスト**
   ```
   1. ヘッダーの歯車アイコンをクリック
   2. ルールを無効化
   3. 該当ルールのエラーが表示されなくなることを確認
   4. ルールを再度有効化
   5. エラーが再表示されることを確認
   ```

3. **ダークモードのテスト**
   ```
   1. ヘッダーのテーマ切り替えアイコンをクリック
   2. ダークモードに切り替わることを確認
   3. すべてのUIが読みやすいことを確認
   4. ライトモードに戻すことを確認
   ```

---

## 既知の問題と制限事項

### 1. textlint統合の未完了（重要）

**現状**: 本家textlintは統合されておらず、モックデータ実装により動作しています。

**影響**:
- ルールの精度は限定的
- 誤検出や検出漏れが発生する可能性
- 本家textlintの詳細なエラーメッセージは利用できない

**対応方針**:
- 短期: モックデータ実装の精度向上（正規表現の改善）
- 長期: 本家textlintの統合（Web Worker + バンドル済みtextlint または サーバーレス関数）

詳細は`README.md`の「今後の開発方針」セクションを参照してください。

### 2. 大量テキストのパフォーマンス

**現状**: 10,000文字を超えるテキストを処理する場合、パフォーマンスが低下する可能性があります。

**原因**: すべての処理がメインスレッドで実行される

**対応方針**:
- Web Workerでのlint処理
- 仮想スクロールの実装（エラーリストが長い場合）
- メモ化の強化

### 3. モバイルでのUX

**現状**: モバイルデバイスでは、エラーリストとテキスト入力エリアが縦に並ぶため、エラーをクリックしても該当箇所が見えにくい

**対応方針**:
- モバイル専用のUIレイアウトを検討
- エラークリック時に自動的にテキストエリアまでスクロールする機能を追加

### 4. バックエンドAPIの不在

**現状**: このプロジェクトはバックエンドAPIを持たず、完全にクライアントサイドで動作します。

**影響**:
- サーバーサイドでのテキスト処理は不可能
- ユーザー認証やデータベース機能は実装されていない

**対応方針**:
- 必要に応じてサーバーレス関数（Vercel Functions、Cloudflare Workers等）を使用

---

## 重要な技術的決定

### 1. モックデータ実装の選択

**理由**: textlintのブラウザ統合が技術的に困難であったため

**利点**:
- UIとして完全に機能する状態を早期に実現
- 後で本家textlintに置き換え可能な設計

**欠点**:
- ルールの精度は本家textlintに劣る

### 2. shadcn/uiの採用

**理由**: 高品質なコンポーネント、Tailwind CSSとの統合、カスタマイズの自由度

**利点**:
- コンポーネントがプロジェクト内にコピーされるため、完全にカスタマイズ可能
- Radix UIベースで、アクセシビリティが高い
- TypeScript完全対応

**注意**:
- 未使用のコンポーネントも含まれるため、ビルドサイズに注意

### 3. localStorageの使用

**理由**: テキストの永続化のため

**制限事項**:
- ブラウザのストレージ制限（通常5-10MB）
- 大量のテキストを扱う場合はIndexedDBへの移行を検討

---

## 開発タスクの管理

### 優先度の高いタスク

1. **本家textlintの統合** (todo.md参照)
   - Web Worker + バンドル済みtextlint
   - または、サーバーレス関数（API）

2. **GitHub Pagesへのデプロイ設定**
   - `.github/workflows`にGitHub Actionsワークフローを作成
   - Viteのビルド設定の最適化（base pathの設定）

3. **テストの追加**
   - ユニットテスト: `useTextlint`フックのロジックテスト
   - コンポーネントテスト: 主要コンポーネントのレンダリングテスト
   - E2Eテスト: ユーザーフローの統合テスト（Playwright推奨）

### 今後の機能追加候補

- ファイルのインポート/エクスポート（Markdown、テキストファイル）
- 履歴機能（過去のチェック結果の保存と復元）
- カスタムルールの追加（ユーザー定義の正規表現パターン）
- 統計情報の表示（文字数、単語数、段落数など）

詳細は`README.md`と`todo.md`を参照してください。

---

## 連絡先とサポート

本プロジェクトに関する質問や問題がある場合は、GitHubのIssuesを使用してください。

- **リポジトリ**: https://github.com/JobAnyol/textlint-web-checker
- **Issues**: https://github.com/JobAnyol/textlint-web-checker/issues

---

## まとめ: Claude AIアシスタントへの重要なリマインダー

### 必ず守ること
1. **日本語で回答**すること
2. **TODO完了時またはユーザーアクション必要時に通知音**を鳴らすこと
3. **TODOにブランチ作成・テスト・コミット・push・PR作成**を含めること
4. **mainブランチへの直接コミットは絶対禁止**
5. **コミット前にPlaywright MCPでテスト**すること
6. **ポート番号を勝手に変更しない**こと
7. **Tailwind CSSを優先**すること
8. **セキュリティ脆弱性を導入しない**こと
9. **ファイル作成時に.gitignoreを確認**すること
10. **影響範囲を慎重に確認**してから修正すること

### 参考ドキュメント
- `README.md`: プロジェクト概要、使い方、技術スタック、設計ポイント
- `todo.md`: タスク管理、実装状況
- `.textlintrc.json`: textlint設定（参照用）

---

**作成日**: 2025年11月18日
**対象**: Claude AIアシスタント
**メンテナンス**: プロジェクトの構造や方針が変更された場合は、このドキュメントを更新してください
