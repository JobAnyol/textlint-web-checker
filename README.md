# Textlint Web Checker

**日本語文書チェッカー - ブラウザ完結型textlintツール**

Textlint Web Checkerは、ブラウザ上で動作する日本語文書の品質チェックツールです。textlintのルールセットを活用し、技術文書やAI生成文書に見られる問題を検出します。

## 🎯 プロジェクトの目的

このプロジェクトは、以下の目標を達成するために開発されました：

- **ブラウザ完結型の実装**: サーバーサイド処理を必要とせず、完全にクライアントサイドで動作する日本語文書チェッカーを提供する
- **textlintルールの活用**: textlint-rule-preset-ja-technical-writing（23ルール）とtextlint-rule-preset-ai-writing（5ルール）を統合し、合計28ルールで文書品質を向上させる
- **ミニマルなUX**: 文字数カウントサイトのようなシンプルで直感的なユーザーインターフェースを実現する
- **リアルタイムフィードバック**: 300msのデバウンス処理により、入力中にリアルタイムでエラーを検出し表示する

## ✨ 主要機能

### 実装済み機能

本プロジェクトでは、以下の機能が完全に実装されています：

**コアチェック機能**

リアルタイムlintチェック機能により、テキスト入力後300msでエラーと警告を検出します。現在、モックデータ実装により以下のルールをシミュレートしています：

- 感嘆符・疑問符の使用チェック
- 文の長さチェック（100文字制限）
- 冗長な表現の検出（「まず最初に」「することができる」など）
- 弱い表現の検出（「かもしれない」「思う」「だろう」）
- 二重助詞の検出
- 連続する単語の検出
- ら抜き言葉の検出
- 連続する漢字のチェック（7文字以上）
- AI生成文書特有の表現パターンの検出（「革命的な」「画期的な」など）
- AI的なリスト書式の検出（✅絵文字の使用）
- AI的な強調パターンの検出（**重要**:など）
- コロンの不適切な使用の検出

**エラー表示とナビゲーション**

エラーリストには、各エラーの詳細情報とともに、該当箇所の前後テキスト（コンテキスト）が表示されます。エラー部分は赤い背景で強調表示され、どの部分に問題があるのかが一目でわかります。エラーをクリックすると、テキストエリア内の該当箇所が自動的に選択され、クリックしたエラーは青い枠で2秒間ハイライト表示されます。

**フィルタリングとカスタマイズ**

ユーザーは「すべて表示」「エラーのみ」「警告のみ」の3つのフィルターを使用して、表示する問題を絞り込むことができます。また、ルール設定ダイアログから個別のルールを有効化・無効化することが可能です。技術文書ルール（6種類）とAI文書ルール（4種類）を自由に組み合わせて使用できます。

**データ管理機能**

入力したテキストはlocalStorageに自動保存され、ブラウザを閉じても次回起動時に復元されます。コピーボタンでテキストをクリップボードにコピーし、クリアボタンで一括削除できます。lint結果はJSON形式でエクスポート可能で、日付付きのファイル名で保存されます。

**UI/UX機能**

ダークモード対応により、ライトテーマとダークテーマを切り替えることができます。レスポンシブデザインにより、デスクトップ（1024px以上）とモバイル（768px以下）の両方で快適に使用できます。日本語フォント（Noto Sans JP）を使用し、読みやすいタイポグラフィを実現しています。

### 統計情報の表示

チェック結果パネルには、エラー数と警告数が大きく表示され、文書の品質を一目で把握できます。エラーは赤色、警告は黄色で色分けされています。

## 🛠 技術スタック

本プロジェクトは、以下の技術スタックで構築されています：

### フロントエンド

| 技術 | バージョン | 用途 |
|------|-----------|------|
| React | 19 | UIライブラリ |
| TypeScript | 5.x | 型安全な開発 |
| Vite | 6.x | ビルドツール |
| Tailwind CSS | 4.x | スタイリング |
| shadcn/ui | latest | UIコンポーネント |
| Wouter | latest | クライアントサイドルーティング |

### textlint関連（計画中）

現在、以下のパッケージがインストールされていますが、ブラウザでの統合は未完了です：

| パッケージ | バージョン | 用途 |
|-----------|-----------|------|
| @textlint/kernel | latest | textlintコアエンジン |
| textlint-rule-preset-ja-technical-writing | latest | 技術文書ルール（23ルール） |
| @textlint-ja/textlint-rule-preset-ai-writing | latest | AI文書ルール（5ルール） |
| @textlint/textlint-plugin-markdown | latest | Markdownサポート |
| @textlint/textlint-plugin-text | latest | プレーンテキストサポート |
| kuromojin | latest | 形態素解析 |

### 開発ツール

| ツール | 用途 |
|--------|------|
| pnpm | パッケージマネージャー |
| ESLint | コード品質チェック |
| Prettier | コードフォーマット |

## 📦 インストールと起動

### 前提条件

- Node.js 22.x以上
- pnpm 9.x以上

### セットアップ手順

リポジトリをクローンし、依存関係をインストールします：

```bash
git clone https://github.com/JobAnyol/textlint-web-checker.git
cd textlint-web-checker
pnpm install
```

開発サーバーを起動します：

```bash
pnpm dev
```

ブラウザで `http://localhost:3000` を開くと、アプリケーションが表示されます。

### ビルド

本番用にビルドする場合は、以下のコマンドを実行します：

```bash
pnpm build
```

ビルドされたファイルは `client/dist` ディレクトリに出力されます。

## 📁 プロジェクト構造

```
textlint-web-checker/
├── client/                    # フロントエンドコード
│   ├── public/               # 静的ファイル
│   ├── src/
│   │   ├── components/       # Reactコンポーネント
│   │   │   └── ui/          # shadcn/uiコンポーネント
│   │   ├── contexts/        # Reactコンテキスト
│   │   │   └── ThemeContext.tsx  # ダークモード管理
│   │   ├── hooks/           # カスタムフック
│   │   │   └── useTextlint.ts    # textlint統合（モック実装）
│   │   ├── pages/           # ページコンポーネント
│   │   │   └── Home.tsx     # メインページ
│   │   ├── lib/             # ユーティリティ
│   │   ├── types/           # TypeScript型定義
│   │   ├── App.tsx          # ルート定義
│   │   ├── main.tsx         # エントリーポイント
│   │   ├── index.css        # グローバルスタイル
│   │   └── const.ts         # 定数定義
│   ├── index.html           # HTMLテンプレート
│   └── vite.config.ts       # Vite設定
├── .textlintrc.json         # textlint設定
├── package.json             # 依存関係
├── tailwind.config.ts       # Tailwind設定
├── tsconfig.json            # TypeScript設定
├── todo.md                  # タスク管理
└── README.md                # このファイル
```

### 主要ファイルの説明

**`client/src/hooks/useTextlint.ts`**

textlint統合のためのカスタムフックです。現在はモックデータ実装により、28種類のルールをシミュレートしています。`lintText`関数は非同期でテキストを解析し、エラーと警告のリストを返します。

**`client/src/pages/Home.tsx`**

メインページのコンポーネントです。テキスト入力エリア、チェック結果パネル、エラーリスト、ルール設定ダイアログなど、すべてのUI要素を含んでいます。300msのデバウンス処理により、リアルタイムでlintチェックを実行します。

**`client/src/contexts/ThemeContext.tsx`**

ダークモードの状態管理を行うReactコンテキストです。`useTheme`フックを通じて、テーマの取得と切り替えが可能です。

**`.textlintrc.json`**

textlintの設定ファイルです。使用するルールセットとプラグインを定義しています。現在は参照用であり、実際のtextlint統合では使用されていません。

## 🎨 使い方

### 基本的な使用方法

アプリケーションを開くと、左側に大きなテキスト入力エリアが表示されます。ここに日本語の文章を入力すると、自動的にlintチェックが開始されます。チェック結果は右側のパネルに表示され、エラー数と警告数が大きく表示されます。

### エラーの確認

エラーリストには、各エラーの詳細情報が表示されます。エラーメッセージの下には、該当箇所の前後テキスト（コンテキスト）が表示され、エラー部分は赤い背景で強調されています。エラーをクリックすると、テキストエリア内の該当箇所が自動的に選択され、どの部分に問題があるのかが明確になります。

### フィルタリング

チェック結果パネルの上部には、3つのフィルターボタンがあります。「すべて表示」ボタンですべてのエラーと警告を表示し、「エラーのみ」ボタンで重要度の高いエラーのみを表示し、「警告のみ」ボタンで軽微な警告のみを表示できます。

### ルール設定

ヘッダー右上の歯車アイコンをクリックすると、ルール設定ダイアログが開きます。ここで、個別のルールを有効化・無効化できます。技術文書ルール（感嘆符・疑問符の禁止、連続する単語、冗長な表現、弱い表現、二重助詞、ら抜き言葉）とAI文書ルール（AI的な誇張表現、AI的なリスト書式、AI的な強調パターン、コロンの使用）を自由に組み合わせて使用できます。

### データの管理

テキスト入力エリアの右上には、「コピー」ボタンと「クリア」ボタンがあります。コピーボタンでテキストをクリップボードにコピーし、クリアボタンでテキストを一括削除できます。チェック結果パネルの右上には「JSON」ボタンがあり、lint結果をJSON形式でダウンロードできます。

### ダークモード

ヘッダー右上の太陽/月アイコンをクリックすると、ライトテーマとダークテーマを切り替えることができます。テーマ設定はlocalStorageに保存され、次回起動時にも反映されます。

## 📝 設計ポイントと実装変更点

### 仕様書に基づいた設計

本プロジェクトは、添付された仕様書「textlintウェブサイト仕様書.md」に基づいて設計されました。仕様書では、以下の主要要件が定義されていました：

- textlint-rule-preset-ja-technical-writing（23ルール）とtextlint-rule-preset-ai-writing（5ルール）の統合
- @textlint/script-compilerを使用したブラウザ向けバンドル
- GitHub Pagesでの静的サイトホスティング
- 文字数カウントサイトのようなミニマルなUI/UX
- リアルタイムlintチェック機能（300msデバウンス）

### 実装時の主要な変更点

開発過程で、以下の重要な変更が行われました：

**1. textlint統合の課題とモックデータ実装**

当初の計画では、@textlint/kernelを使用してブラウザ上でtextlintを直接実行する予定でした。しかし、以下の技術的課題により、実装が困難であることが判明しました：

- @textlint/kernelのブラウザ統合が予想以上に複雑
- プラグインとルールの動的読み込みが正しく機能しない
- @textlint/script-compilerを使用したバンドル作成が現在のReactアプリ構造では困難

この問題に対処するため、現在はモックデータ実装により28種類のルールをシミュレートしています。`client/src/hooks/useTextlint.ts`内の`generateMockLintResult`関数が、正規表現とパターンマッチングを使用してエラーを検出します。この実装により、UIとして完全に機能する状態を実現し、後で本家textlintに置き換え可能な設計になっています。

**2. エラー箇所のコンテキスト表示機能の追加**

仕様書には明記されていませんでしたが、ユーザーからの要望により、エラー箇所のコンテキスト表示機能を追加しました。この機能により、エラーリストに該当箇所の前後テキストが表示され、エラー部分が赤い背景で強調表示されます。エラーをクリックすると、テキストエリア内の該当箇所が自動的に選択され、クリックしたエラーは青い枠で2秒間ハイライト表示されます。

この機能は、以下の実装により実現されています：

- `getErrorContext`関数：エラー位置から前後20文字のコンテキストを抽出
- `scrollToError`関数：エラークリック時に該当箇所を選択し、スクロール
- `selectedErrorIndex`状態：クリックしたエラーを一時的にハイライト表示

**3. ルール設定UIの実装**

仕様書では「個別ルールの有効化/無効化トグル」が要件として記載されていましたが、具体的なUI設計は含まれていませんでした。実装では、shadcn/uiのDialogコンポーネントとSwitchコンポーネントを使用して、直感的なルール設定ダイアログを作成しました。技術文書ルールとAI文書ルールを別々のセクションに分けて表示し、各ルールの名前と有効/無効状態を管理できます。

**4. デザインシステムの構築**

仕様書では「文字数カウントサイトのようなミニマルなUI/UX」が要求されていましたが、具体的なデザイン指針は含まれていませんでした。実装では、以下のデザインシステムを構築しました：

- カラーパレット：白/ライトグレー背景、青アクセント、OKLCHカラーフォーマット
- タイポグラフィ：Noto Sans JPフォント、システムフォントスタックのフォールバック
- レスポンシブデザイン：768pxブレークポイント、モバイルファースト
- ダークモード：完全なダークテーマサポート

### アーキテクチャの特徴

本プロジェクトのアーキテクチャには、以下の特徴があります：

**完全なクライアントサイド実装**

すべての処理がブラウザ上で実行されるため、サーバーサイドの実装は不要です。これにより、GitHub Pagesなどの静的ホスティングサービスで簡単にデプロイできます。

**Reactフックベースの状態管理**

Reduxなどの外部状態管理ライブラリを使用せず、React標準のuseStateとuseContextを使用して状態を管理しています。これにより、シンプルで保守しやすいコードベースを実現しています。

**モジュラーなコンポーネント設計**

shadcn/uiのコンポーネントを活用し、再利用可能なUIコンポーネントを構築しています。各コンポーネントは独立しており、テストと保守が容易です。

**デバウンス処理による最適化**

テキスト入力時に300msのデバウンス処理を適用することで、不要なlintチェックを削減し、パフォーマンスを向上させています。

## 🚀 今後の開発方針

本プロジェクトは現在、モックデータ実装により完全に機能していますが、以下の改善が推奨されます：

### 優先度: 高

**1. 簡易版ルールの手動実装**

現在のモックデータ実装をベースに、より精度の高いルール実装に移行します。正規表現とパターンマッチングを改善し、誤検出を減らします。特に、以下のルールの精度向上が重要です：

- 二重助詞の検出（現在は単純なパターンマッチング）
- 連続する単語の検出（現在は全角/半角の区別が不完全）
- 文の長さチェック（現在は行単位、文単位への変更が必要）

**2. 本家textlintの統合**

長期的には、本家textlintを正しく統合することが望ましいです。以下のアプローチを検討してください：

- **Web Worker + バンドル済みtextlint**: @textlint/script-compilerを使用して、textlintとすべてのルールを1つのJavaScriptファイルにバンドルし、Web Workerで実行します。これにより、UIをブロックせずにlintチェックを実行できます。
- **サーバーレス関数（API）**: textlintをサーバーサイドで実行し、APIとして提供します。この方法は実装が簡単で確実に動作しますが、完全なクライアントサイド実装ではなくなります。

**3. GitHub Pagesへのデプロイ設定**

`.github/workflows`ディレクトリにGitHub Actionsワークフローを作成し、mainブランチへのプッシュ時に自動的にビルドとデプロイが行われるようにします。以下の設定が必要です：

- Viteのビルド設定の最適化（base pathの設定）
- GitHub Pagesの有効化
- カスタムドメインの設定（オプション）

### 優先度: 中

**4. テストの追加**

現在、自動テストは実装されていません。以下のテストを追加することを推奨します：

- ユニットテスト：`useTextlint`フックのロジックテスト
- コンポーネントテスト：主要コンポーネントのレンダリングテスト
- E2Eテスト：ユーザーフローの統合テスト

**5. パフォーマンスの最適化**

大量のテキスト（10,000文字以上）を処理する場合、パフォーマンスが低下する可能性があります。以下の最適化を検討してください：

- 仮想スクロールの実装（エラーリストが長い場合）
- Web Workerでのlint処理（UIスレッドをブロックしない）
- メモ化の強化（React.memoとuseMemoの活用）

**6. アクセシビリティの向上**

現在、基本的なアクセシビリティは実装されていますが、以下の改善が可能です：

- キーボードナビゲーションの強化
- スクリーンリーダー対応の改善
- ARIAラベルの追加

### 優先度: 低

**7. 追加機能の実装**

以下の機能を追加することで、ユーザー体験をさらに向上させることができます：

- ファイルのインポート/エクスポート（Markdown、テキストファイル）
- 履歴機能（過去のチェック結果の保存と復元）
- カスタムルールの追加（ユーザー定義の正規表現パターン）
- 統計情報の表示（文字数、単語数、段落数など）

## 🤝 後任への引き継ぎ事項

### 重要な技術的決定

**モックデータ実装の選択**

textlintのブラウザ統合が技術的に困難であったため、モックデータ実装を選択しました。この決定により、UIとして完全に機能する状態を早期に実現できましたが、ルールの精度は本家textlintに劣ります。後任の方は、本家textlintの統合を検討してください。

**shadcn/uiの採用**

UIコンポーネントライブラリとして、shadcn/uiを採用しました。shadcn/uiは、Radix UIをベースにした高品質なコンポーネントを提供し、Tailwind CSSとの統合が容易です。コンポーネントはプロジェクト内にコピーされるため、カスタマイズが自由に行えます。

**localStorageの使用**

テキストの永続化にlocalStorageを使用しています。これにより、ブラウザを閉じても入力内容が保持されますが、ブラウザのストレージ制限（通常5-10MB）に注意してください。大量のテキストを扱う場合は、IndexedDBへの移行を検討してください。

### 既知の問題と制限事項

**1. textlint統合の未完了**

現在、本家textlintは統合されておらず、モックデータ実装により動作しています。ルールの精度は限定的であり、誤検出や検出漏れが発生する可能性があります。

**2. 大量テキストのパフォーマンス**

10,000文字を超えるテキストを処理する場合、パフォーマンスが低下する可能性があります。これは、すべての処理がメインスレッドで実行されるためです。

**3. モバイルでのUX**

モバイルデバイスでは、エラーリストとテキスト入力エリアが縦に並ぶため、エラーをクリックしても該当箇所が見えにくい場合があります。

### 開発時の注意事項

**依存関係の更新**

依存関係を更新する際は、特にReact、Vite、Tailwind CSSのメジャーバージョンアップに注意してください。これらのライブラリは頻繁に破壊的変更を導入します。

**TypeScriptの型エラー**

textlint関連のパッケージには型定義が不完全なものがあります。`client/src/types/textlint.d.ts`に型定義を追加していますが、本家textlintを統合する際は追加の型定義が必要になる可能性があります。

**ビルドサイズの最適化**

現在、ビルドサイズは最適化されていません。本番環境にデプロイする前に、以下の最適化を検討してください：

- Tree shakingの有効化
- 未使用のshadcn/uiコンポーネントの削除
- Code splittingの実装

### 連絡先とサポート

本プロジェクトに関する質問や問題がある場合は、GitHubのIssuesを使用してください。

- リポジトリ: https://github.com/JobAnyol/textlint-web-checker
- Issues: https://github.com/JobAnyol/textlint-web-checker/issues

## 📄 ライセンス

このプロジェクトのライセンスは未定です。後任の方が適切なライセンスを選択してください。

## 🙏 謝辞

本プロジェクトは、以下のオープンソースプロジェクトを参考にしています：

- [textlint](https://textlint.github.io/) - 日本語文書のlintツール
- [shadcn/ui](https://ui.shadcn.com/) - UIコンポーネントライブラリ
- [Tailwind CSS](https://tailwindcss.com/) - ユーティリティファーストCSSフレームワーク

---

**作成者**: Manus AI  
**最終更新**: 2025年11月15日
